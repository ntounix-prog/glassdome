# Proxmox API Token Format & Example

## Your Setup

**User:** `apex@pve`

## API Token Format

A Proxmox API token consists of 3 parts:

1. **User**: `apex@pve`
2. **Token Name**: Whatever you choose (e.g., `glassdome-token`)
3. **Token Secret**: UUID generated by Proxmox (e.g., `a1b2c3d4-1234-5678-9abc-def012345678`)

---

## How to Create Token for apex@pve

### Method 1: Proxmox Web UI

1. Login to Proxmox: `https://your-proxmox-ip:8006`
   - Username: `apex@pve`
   - Password: your password

2. Navigate to:
   ```
   Datacenter (left sidebar)
     → Permissions
       → API Tokens
         → Add
   ```

3. Fill in the form:
   ```
   User: apex@pve
   Token ID: glassdome-token
   [ ] Privilege Separation (UNCHECK THIS!)
   Comment: API token for Glassdome
   ```

4. Click **Add**

5. **COPY THE SECRET IMMEDIATELY!** It looks like:
   ```
   ┌────────────────────────────────────────┐
   │ Token created successfully!            │
   │                                        │
   │ Token ID: apex@pve!glassdome-token     │
   │                                        │
   │ Secret:                                │
   │ a1b2c3d4-1234-5678-9abc-def012345678   │
   │                                        │
   │ ⚠️  The secret will not be shown again! │
   └────────────────────────────────────────┘
   ```

6. **Save this secret!** You'll need it for the `.env` file

### Method 2: SSH Command Line

```bash
# SSH to Proxmox
ssh apex@your-proxmox-ip

# Create token
pveum user token add apex@pve glassdome-token --privsep 0

# Output:
# ┌───────────────┬──────────────────────────────────────┐
# │ key           │ value                                │
# ╞═══════════════╪══════════════════════════════════════╡
# │ full-tokenid  │ apex@pve!glassdome-token             │
# ├───────────────┼──────────────────────────────────────┤
# │ info          │                                      │
# ├───────────────┼──────────────────────────────────────┤
# │ value         │ a1b2c3d4-1234-5678-9abc-def012345678 │
# └───────────────┴──────────────────────────────────────┘

# Copy the "value" - that's your token secret!
```

---

## .env File Format

Once you have the token, your `.env` file should look like this:

```bash
# Proxmox Configuration
PROXMOX_HOST=your-proxmox-ip-or-hostname
PROXMOX_USER=apex@pve
PROXMOX_TOKEN_NAME=glassdome-token
PROXMOX_TOKEN_VALUE=a1b2c3d4-1234-5678-9abc-def012345678
PROXMOX_VERIFY_SSL=false
PROXMOX_NODE=pve

# Template IDs
UBUNTU_2204_TEMPLATE_ID=9000
UBUNTU_2004_TEMPLATE_ID=9001
```

**Replace:**
- `your-proxmox-ip-or-hostname` → Your actual Proxmox IP (e.g., `192.168.1.100` or `proxmox.local`)
- `a1b2c3d4-1234-5678-9abc-def012345678` → The actual secret from step 5 above

---

## Real Example

Let's say:
- Proxmox IP: `192.168.1.50`
- User: `apex@pve`
- Token name: `glassdome-token`
- Token secret (from Proxmox): `12345678-abcd-ef12-3456-7890abcdef12`
- Node name: `pve`

Your `.env` would be:

```bash
# Proxmox Configuration
PROXMOX_HOST=192.168.1.50
PROXMOX_USER=apex@pve
PROXMOX_TOKEN_NAME=glassdome-token
PROXMOX_TOKEN_VALUE=12345678-abcd-ef12-3456-7890abcdef12
PROXMOX_VERIFY_SSL=false
PROXMOX_NODE=pve

# Template IDs
UBUNTU_2204_TEMPLATE_ID=9000
UBUNTU_2004_TEMPLATE_ID=9001
```

---

## Token Secret Format

The token secret is always a **UUID** (Universally Unique Identifier):

**Format:** `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`

Where `x` is a hexadecimal digit (0-9, a-f)

**Examples:**
- ✅ `12345678-abcd-ef12-3456-7890abcdef12`
- ✅ `a1b2c3d4-5678-90ab-cdef-1234567890ab`
- ✅ `00000000-1111-2222-3333-444444444444`
- ❌ `mysecretpassword` (not a UUID!)
- ❌ `abc123` (too short!)

**Length:** Exactly 36 characters (32 hex digits + 4 hyphens)

---

## Alternative: Password Authentication

If you don't want to create a token, you can use password authentication:

```bash
# Proxmox Configuration
PROXMOX_HOST=192.168.1.50
PROXMOX_USER=apex@pve
PROXMOX_PASSWORD=your-password-here
PROXMOX_VERIFY_SSL=false
PROXMOX_NODE=pve
```

**Note:** Token authentication is more secure!

---

## Testing Your Token

Once you have the `.env` file set up, test it:

```bash
# Method 1: Run setup wizard (will test connection)
python3 setup_proxmox.py

# Method 2: Run test script
python3 test_vm_creation.py

# Method 3: Test manually with curl
curl -k -H "Authorization: PVEAPIToken=apex@pve!glassdome-token=YOUR-SECRET-HERE" \
  https://your-proxmox-ip:8006/api2/json/version

# Should return Proxmox version info if working
```

---

## Troubleshooting

### "Authentication failed"

**Check:**
1. Token secret copied correctly (all 36 characters)
2. No extra spaces in `.env` file
3. Token name matches what you created
4. User is `apex@pve` not `apex@pam`

### "Permission denied"

**Fix:**
- In Proxmox UI, make sure "Privilege Separation" was **UNCHECKED**
- Or grant specific permissions to the token

### Can't find where to create token

**Path:**
```
Proxmox Web UI
  → Datacenter (left sidebar, at top)
    → Permissions (expand)
      → API Tokens
        → Add (button)
```

---

## Quick Reference

| Field | Your Value | Example |
|-------|------------|---------|
| User | `apex@pve` | `apex@pve` |
| Token Name | Your choice | `glassdome-token` |
| Token Secret | From Proxmox | `12345678-abcd-ef12-3456-7890abcdef12` |
| Full Token ID | `apex@pve!glassdome-token` | `apex@pve!glassdome-token` |

**In `.env`:**
```bash
PROXMOX_USER=apex@pve
PROXMOX_TOKEN_NAME=glassdome-token
PROXMOX_TOKEN_VALUE=12345678-abcd-ef12-3456-7890abcdef12
```

---

## Next Steps

1. ✅ Create API token (follow steps above)
2. ✅ Copy the secret
3. ✅ Create `.env` file with token
4. ✅ Run `python3 setup_proxmox.py` to test
5. ✅ Run `python3 test_vm_creation.py` to create first VM

Need help? The setup wizard (`setup_proxmox.py`) will guide you through each step!

